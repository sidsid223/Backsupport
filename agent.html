<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Agent Panel</title>
<style>
body{background:#080c16;color:white;font-family:Arial;padding:20px;}
.wrap{max-width:900px;margin:auto;background:#111725;padding:20px;border-radius:10px;}
.chat{height:60vh;overflow:auto;background:#0f1625;padding:10px;border-radius:10px;}
.msg{padding:8px;margin:6px 0;border-radius:6px;background:#222c3d;}
.msg.agent{text-align:right;background:#0ea5ff;color:#06121e;}
.composer{margin-top:10px;display:flex;gap:6px;}
input,button{padding:10px;border:none;border-radius:6px;}
button{background:#0ea5ff;color:black;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>
<div class="wrap">
<h2>Agent Panel</h2>
<input id="agentName" placeholder="Agent name" value="Agent">
<input id="sessionInput" placeholder="Session ID">
<button id="joinBtn">Join</button>

<div class="chat" id="messages"></div>

<div class="composer">
<input id="msgInput" placeholder="Type message..." disabled>
<button id="sendBtn" disabled>Send</button>
</div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();
let sessionId=null;
document.getElementById("joinBtn").onclick=()=>{
  sessionId=document.getElementById("sessionInput").value.trim();
  if(!sessionId)return;
  socket.emit("join-session",{sessionId,name:document.getElementById("agentName").value,role:"agent"});
};
socket.on("chat-history",(h)=>{
  const m=document.getElementById("messages");
  m.innerHTML=""; h.forEach(addMsg);
  document.getElementById("msgInput").disabled=false;
  document.getElementById("sendBtn").disabled=false;
});
socket.on("message",addMsg);

function addMsg(msg){
  const d=document.createElement("div");
  d.className="msg"+(msg.role==="agent"?" agent":"");
  d.textContent=msg.name+": "+msg.text;
  document.getElementById("messages").appendChild(d);
}
document.getElementById("sendBtn").onclick=send;
document.getElementById("msgInput").onkeydown=e=>{if(e.key==="Enter")send();};

function send(){
  const t=document.getElementById("msgInput").value.trim();
  if(!t)return;
  socket.emit("send-message",{sessionId,name:document.getElementById("agentName").value,text:t});
  document.getElementById("msgInput").value="";
}
</script>
</body></html>
